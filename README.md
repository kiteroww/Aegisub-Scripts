# Kite-Macros for Aegisub

A set of automation scripts for [Aegisub](http://www.aegisub.org/) focused on timing, colour management, and typesetting effects. Built for fansubbing workflows but useful for any subtitle work.

All three scripts share the `Kite-Macros/` menu and expose their core functions as standalone Utility macros, so you can bind hotkeys to anything you use often.

---

## Scripts

| Script | Version | What it does | Languages |
|---|---|---|---|
| **Chronorow Master** | 3.0 | Timing, auditing, text processing, data import | English, Spanish, Portuguese |
| **Rhearow Master** | 3.0 | Typesetting effects, perspective, masks, visual tools | English, Spanish |
| **Zheus Colormaster** | 2.0 | Colour management, gradients, animation, FX | Spanish (UI) |

---

## Chronorow Master

The timing and line-management workhorse. Open the main dialog, tick the modules you need, set your values, and press EXECUTE. Nothing changes until you do.

### Timing Audit Module

Analyses your selection and tags problems in the Effect field. You pick which boundary to check (start, end, or both) and Chronorow does the rest.

**Keyframe Seal** marks lines that land on a keyframe (`[KF-S]` / `[KF-E]`). **Twin KF** flags duplicate keyframes within a configurable range — useful when a scene cut produces two KFs close together. **Miss KF** does the opposite: finds lines that *should* be on a keyframe but aren't. **Overtime** marks any line exceeding a duration threshold (recommended 5500 ms for dialogue). **Overlap Alert** catches overlapping lines. **Gap Marker** detects subtitle blinks — tiny gaps between consecutive lines that make the viewer's eye flicker. Configurable threshold and custom tag. **Mark Uppercase** flags lines written entirely in capitals.

### Text Processing Engine

**Sentence Splitter** divides lines at `.?!` boundaries, with an optional comma/semicolon mode and a preview-only simulation that just tags `[2S]`/`[3S]` without splitting. **Line Cleaver** splits at existing `\N` tags into separate lines. **Kana-Beat** converts romaji words to `{\k}` syllable timing for karaoke. **Punctuation Check** marks lines missing final punctuation.

### Marabunta (Data Import)

Paste raw Dialogue lines into the textbox and import data by time overlap. Five modes: **Ant Effects** imports the Effect field, **Ant Lines** imports text content, **Ant Actor** assigns Actor by best overlap, **Ant Songs** duplicates a group using a sync point (comment on layer 50), and **Ant Twins** works like Ant Lines but restricts matching to the same layer.

### CPS Metrics

**CPS Ranker** sorts lines by characters per second. **Show Avg** displays the average CPS of the current selection.

### Quick Tools

Select a tool from the dropdown and press EXECUTE to run it. Each one is also available as a standalone macro under `Kite-Macros/Utility/`.

**Kite Timing** — Lead-in/lead-out with keyframe snapping and chaining. Uses ms-based timing with configurable base, max, and chain thresholds (set in Config). **Blank Eraser** — Deletes empty or whitespace-only lines. **Join Same Text** — Merges consecutive lines with identical text. **Time Picker** — Select lines within a time range. **Style Sentinel** — Filter or delete by style name with confirmation. **Caption Clarifier** — Removes `[bracketed]` annotations. **LeBlanc Six** — Automatic line breaks by video width. **Copy Times** — Copies start/end from the first selected line to the rest. **Extract Tags** — Moves `{tags}` to the Effect field. **Reinsert Tags** — Returns the Effect field back into the text. **Sort by Length** — Sorts by character count, longest first. **Punctuation ¡!/¿?** — Adds opening inverted punctuation for Spanish. **Swap Comment** — Swaps visible text with `{commented}` text. **Add an8** — Inserts `{\an8}` for top alignment. **Copy Fold Group** — Copies a fold group to the clipboard. **Double Italics** — Flags broken `\i1...\i0` patterns. **Import Text (Source Timing)** — Pastes lines from clipboard or a dialog box, applied to the selection's timing. **Ellipsis Eraser** — Cleans leading `...` dots. **Actor Parser** — Splits `(A)...(B)` lines, italicises `<thoughts>`, assigns sticky actors. **AE Keyframe Export** — Exports position, scale, and rotation data to an After Effects keyframe file. **Stutter Manager** — Adds stutter patterns (`L-Lword`) with punctuation-aware handling for `¡¿`. **Actor Manager** — Bulk rename or merge actors across the selection. **Remplacer** — Bulk text replacement preserving tags.

### Other Buttons

**KPP** (Kite Post-Processor) — The dedicated timing post-processor. Configurable lead-in, lead-out, keyframe snap range, and chaining distance, all in frames. Shows statistics when done.

**LazyTimer (EFS v2)** — Automatic timing refinement from FFmpeg silence analysis. It reads silence-detection logs (generated by FFmpeg at different dB thresholds) and adjusts line start/end times to align with detected speech boundaries. Three analysis modes are available:

- **LazyFusion** (default) — The most accurate mode. Uses an Evidence Fusion Score (EFS) that combines multiple signals: silence boundaries, VAD (Voice Activity Detection) segments, and flux onset/offset candidates. It scans each line's duration in 5 ms steps, computing an activity score at each point, and snaps start/end to the first/last point where speech activity is detected. VAD data is optional but strongly recommended — without it, LazyFusion falls back to silence-only detection and loses precision. Silence files are also optional (you can cancel any of them), making this the most flexible mode. Flux data provides additional edge-detection confidence.
- **Cluster (±ms)** — The simpler, more conservative mode. Takes all silence boundaries within a configurable window around each line edge (the ± limit in ms), scores them by proximity, silence quality, and source confidence, then clusters nearby candidates and picks the best cluster's weighted median. Requires all three silence files (-30 dB, -40 dB, -50 dB). VAD and flux are optional boosters.
- **Table (±ms)** — A noise-table approach. Inverts the silence data to build a noise map, merges small gaps, drops inconclusive edge fragments, and picks the best noise cluster by coverage and proximity. Only needs one silence file. Useful when you want a quick pass with minimal setup.

All three modes support Apply Start / Apply End toggles, configurable tagging (marks changes in the Effect field as `[LZ Δs=+42ms]` etc.), and tag scope filtering. The limit parameter (ms) controls how far from each line boundary the algorithm is allowed to search.

**Extract KF** — Generates keyframes via SCXvid. **Config** — Language selection, LazyTimer settings, Gap Marker thresholds, Import Text source mode, and Kite Timing parameters.

---

## Rhearow Master

The typesetting and visual effects toolkit. Everything lives in one dialog — perspective, masks, text effects, and borders side by side. Settings are saved between sessions with the Remember button.

### Perspective

Creates 3D rotation from a `\clip` with 3 or 4 points. Three modes: **Generate 4th** completes a quadrilateral from 3 points, **Gen+Apply** generates the 4th point and applies `\frx\fry\frz` in one go, and **Apply Only** applies rotation from an existing 4-point clip. Options to copy the clip to subsequent lines, keep the original as a comment, remove `\clip` after processing, and normalise vertex order.

### Masks

Creates solid vector shapes from a `\clip` or from predefined shapes (square, circle, triangle, rounded). Masks can be created on a new layer, replace an existing `\p1` drawing, use bicubic rendering (`\q2`), and have custom transparency and colour. Custom masks can be saved to a file and reused.

### Tools

Perspective and clip utilities available from a dropdown: **Copy Persp (Project)** copies `\frx\fry\frz` with `\org` recalculated for each line's position, **Copy Persp (Exact)** copies the tags as-is, **Copy Clip** copies `\clip`/`\iclip` from the first line to the rest, and **Clip ↔ iClip** converters.

### Scale (Text Fitting)

Fits text inside a rectangular `\clip` area. Four modes: **fill** stretches to fill (may distort), **prop** scales proportionally, **center** centres at clip midpoint, and **justify** auto-wraps with `\N` and justifies to margins. Configurable margin padding in pixels.

### Text

**Case conversion** with UPPER, lower, Title, and Sentence modes. **Typewriter** effect in two flavours: per-frame (42 ms/character) or proportional to line duration. **Vertical Drop** splits each character into a separate line with `\pos` — though it may misbehave with emojis or composed Unicode.

### Circular

Arranges text along a curve. The line needs both `\pos` (start point) and `\org` (circle centre). Three rotation modes: **Normal** (letters follow the curve), **Inverted** (180° flip), and **Vertical** (letters stay upright). Adjustable radius modifier and kerning. Spaces are filtered out automatically.

### Focus (Blur & Glow)

Multi-layer blur and glow effects. **Blur+Glow** adds a glowing aura behind text, **Blur+Layers** creates border-only layers without glow. Configurable intensity, opacity, and glow colour. **Double layer** adds an extra border layer for depth. **Fix Fades** corrects `\fad` timing across all generated layers with an adjustable offset.

### Borders

Creates up to 4 stacked border layers with individual size and colour. Borders accumulate from innermost to outermost, and the original text sits on top with `\bord0`.

### Mass-Signs

A tag-preserving bulk editor for sign typesetting. Groups lines with identical visible text, presents them side by side (original vs. modified), and applies changes to all matching lines at once. Options to skip vector drawings (`\p1`) and cap character length.

### Standalone Macros

Perspective, Masks, Scale, Circular, Focus, Vertical Drop, Mass-Signs, and all five Tools are individually registered under `Kite-Macros/Utility/` using your saved settings.

---

## Zheus Colormaster

The colour management suite. Handles everything from per-actor colour assignment to animated gradients and visual effects, with a built-in Lua console.

### Chroma Manager

The main panel. Scans the selection, groups lines by Actor, and shows their `\c`, `\3c`, and `\4c` colours with a live contrast ratio indicator. Contrast is checked between primary and border colours following WCAG-style luminance ratios — icons flag critical (`⛔ <2.5`), low, or passing (`✓ ≥4.5`) contrast.

Three output modes: **Tags** injects colour overrides into the text, **Styles** creates new ASS styles per actor with the chosen colours, and **Clean** strips all colour tags. A conflict report detects mixed colours within the same actor. Paginated UI for large casts.

Supports **Export/Import** of colour databases as plain-text files, so you can reuse colour schemes across projects.

### VSFilterMod / 4-Corner Manager

Dedicated panel for `\1vc`, `\3vc`, and `\4vc` four-corner gradient tags (requires VSFilterMod or xy-VSFilter). Each actor gets four colour pickers per corner. Detects and reports mixed VSF/non-VSF usage across actors.

### Spectrum Gradient

Gradient from 2 to 5 colours across lines or individual characters. Three modes: **Line** assigns one colour per line, **Character** assigns one per letter (Unicode-aware), and **GBC** (Gradient by Character) interpolates between existing `\c` tags already in the text — it reads whatever colour blocks you've placed and fills the gaps. Supports `\c`, `\2c`, `\3c`, and `\4c`.

### Kinetic Transform

Generates `\t()` animations over ASS properties (`\fscx`, `\fscy`, `\frz`, `\bord`, `\blur`, `\alpha`, `\fsp`). Configurable start/end values, number of steps, acceleration curve, yoyo mode (alternates direction on even steps), time-based step calculation, and start offset in milliseconds.

### KColor (Kinetic Colour)

Animated colour transitions using `\t()`. Pick a start and end colour, choose the tag (`\c`, `\2c`, `\3c`, `\4c`), and it shares the same step/accel/yoyo/time/offset controls as Kinetic Transform.

### 4-Corner Gradient

Injects four-corner gradient tags directly. Pick colours for each corner (top-left, top-right, bottom-left, bottom-right), choose the tag (`\1vc` through `\4vc`), and optionally clean previous `\vc` tags.

### Colour Replace

Scans the selection for every unique colour, shows a before/after colour picker for each one, and replaces across all lines — including inside `\vc()` tags.

### Lua Console

A sandboxed Lua environment with access to `subs`, `sel`, `meta`, `styles`, `karaskel`, `aegisub`, and the full `Z` module. Useful for quick batch operations without writing a separate script.

### FX Tools

Quick effects, most of which require a loaded video (position the playhead at the desired frame before running).

**One Color** — `\t()` transition to a single colour from the current frame. **To Style** — reverse transition from a flat colour back to the style's original colours. **Split Line** — splits a line at a `|` marker at the current frame, hiding the second half on the first segment. **Split Line Fad** — same split but with a `\fad(250,0)` crossfade on the second segment. **V-Shake / H-Shake** — screen-shake using `\org` + alternating `\frz`, configurable interval. **Flashback** — adds `\fad(200,200)`. **Scale Up / Scale Down** — animated scale (110% / 90%) from the current frame.

### Standalone Macros

Chroma Manager, Gradient by Char (GBC), Colour Replace, and all FX tools are individually registered under `Kite-Macros/Utility/`.

---

## Hotkeys

Every core function from all three scripts is registered as a standalone macro under `Kite-Macros/Utility/`. This means you can bind hotkeys to any of them through Aegisub's `Preferences > Hotkeys` menu — and you really should. The main dialogs are fine for exploring features, but once you know what you need, running Kite Timing, Perspective, or GBC from a hotkey is considerably faster than navigating through menus every time.

Standalone macros use your saved settings (from Config / Remember / Save respectively), so you configure once in the main dialog and then just fire the hotkey. This is the intended workflow: set up your parameters, save them, and from then on it's one keypress.

The full list of individually registered macros:

### From Chronorow Master

`Extract Tags` · `Reinsert Tags` · `Kite Timing (Lead-in/out + KF Snap)` · `Copy Times` · `Swap Comment` · `Blank Eraser` · `Join Same Text` · `Time Picker` · `Style Sentinel` · `Caption Clarifier` · `LeBlanc Six` · `Sort by Length` · `Mark Uppercase` · `Add an8` · `Copy Fold Group` · `Double Italics` · `Frame to Effect` · `Import Text (Source Timing)` · `Ellipsis Eraser` · `Actor Parser (Split & Format)` · `AE Keyframe Export (Full Data)` · `Stutter Generator (L-Lword)` · `Actor Manager (Rename/Merge)` · `Remplacer (Text Replacer)` · `Punctuation/Exclamation` · `Punctuation/Question` · `Punctuation/Both`

### From Rhearow Master

`Perspective` · `Masks` · `Scale` · `Circular` · `Focus` · `Text - Vertical Drop` · `Mass-Signs` · `Tools/Copy Persp (Project)` · `Tools/Copy Persp (Exact)` · `Tools/Copy Clip` · `Tools/Clip to iClip` · `Tools/iClip to Clip`

### From Zheus Colormaster

`Chroma Manager` · `Gradient by Char (GBC)` · `Reemplazar Colores` · `FX/One Color (Gold)` · `FX/To Style (Gold)` · `FX/Split Line` · `FX/Split Line Fad` · `FX/V-Shake` · `FX/H-Shake` · `FX/Flashback` · `FX/Scale Up` · `FX/Scale Down`

---

## Installation

1. Copy the `.lua` files into your Aegisub automation directory:
   - **Windows**: `%APPDATA%\Aegisub\automation\autoload\`
   - **macOS**: `~/Library/Application Support/Aegisub/automation/autoload/`
   - **Linux**: `~/.aegisub/automation/autoload/`
2. Restart Aegisub (or reload automations from the menu).
3. The scripts appear under `Kite-Macros/` in the Automation menu.

All three scripts are independent — install whichever ones you need.

### Dependencies

- **Aegisub 3.2.2+** (required for `aegisub.project_properties`)
- **karaskel** (bundled with Aegisub)
- **FFmpeg** — Required for LazyTimer silence detection (Chronorow). Generate silence logs with something like `ffmpeg -i audio.wav -af silencedetect=n=-30dB:d=0.3 -f null - 2> silence_30.txt`. Path configured in Config.
- **A VAD tool** (e.g. Silero VAD, pyannote, or any tool that outputs a TSV with `start\tend` columns) — Optional but recommended for LazyFusion mode. Without VAD data, LazyFusion relies solely on silence detection and loses its main advantage over the other modes.
- **SCXvid** — Required only for Extract KF (Chronorow). Path configured in Config.
- **VSFilterMod** or **xy-VSFilter** — Required only for 4-corner gradient tags (Zheus).

### Configuration

Each script saves its settings to a config file in your Aegisub user directory:

- `chronorow_config.lua` — language, KPP values, Kite Timing parameters, LazyTimer, Gap Marker
- `rhearow.conf` — all panel defaults, language
- `zheus_config.lua` — dashboard values, last-used colours
- `maya_masks.txt` — custom Rhearow masks

---

## Licence

These scripts are provided as-is for the fansubbing community. Do whatever you like with them.

---

*Kiterow*
